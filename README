1) There are 7 matlab scripts included:

1.1) read_align.m 	This is the main program. In order to work it needs pdb2gro.m (as it is written now, it needs a slightly modified version of pdb2gro which is included in this tar). 

It also needs the file CL_indices_x_x_x.mat, which is the output of the script label_upper_lower.m (should name it better).

Two additional input files are required, the trajectory file (see 2.1 below), and the pdb file (see 2.3 below)

1.2) label_upper_lower.m 	This script takes traj_lipids_flat_x_x_x.trr as input (see 2.2 below), and constructs a mat file which includes the indices of the CL in the upper and lower leaflets.

1.3) build_bond_matrix.m	This script builds the matrix of pair bonds and writes the psf file for bond visualisation in vmd. It requires the same pdb file as (1.1), (see 2.3 below).

1.4) pdb2gro.m  	This function is slightly modified, and now it takes a file handler as an additional argument, so it doesn't open and close the output file at each iteration.

1.5-1.7) the trr2matlab functions.
-------------------------------------------------------------------------------------------

2) Input files in gromacs_files/:

2.1) trajectory file:   traj_lipids_x_x_x.trr

generate trr using 

	trjconv -f raw_gromacs_out.trr -s simulation_tprfile.tpr -o traj_lipids_x_x_x.trr -n index.ndx -dt 1000
	
		here we are removing water and ions, downsampling, and putting the trajectory in trr format

 	index.ndx contains a group with all lipids and no water (make_ndx -f tprfile.tpr -o index.ndx)
	raw_gromacs_out.* can be a .trr or .xtc or any trajectory file


2.2) flat trajectory file: traj_lipids_flat_x_x_x.trr

	This file can be generated with trjconv using a trr or gro file from the equilibration phase of gromacs output.
	Same as 2.1 it should only include the lipids, and actually only 1 frame is necessary (the equilibration trajectories are short enough that it 		doean't matter)


2.3) pdb file: lipids_edc_x_x_x.pdb


First remove water from gromacs raw output gro file with trjconv (this is VERY IMPORTANT or the aligned .gro output from (1.1) will contain al the PW, and will be huge and the script very slow) 

NOTE: 	I changed the name POPG to GPOP in the gro file (using sed):
      	sed -i 's/POPG/GPOP/g' noWater_bilayer_x_GPOP.gro 
      
     	 because pdb only uses 3 letters for residue name 
      	(and thus POPG and POPE were both POP in pdb format)


Then generate pdb with:
      editconf -f noWater_bilayer_x_GPOP.gro -o lipids_edc_x_x_x_.pdb

----------------------------------------------------------------------
3) Input files which are in intermediate_files/:

3.1) CL_indices_x_x_x.mat

generated by matlab script label_upper_lower.m

So, one MUST run label_upper_lower.m before the alignment script

---------------------------------------------------------------------
4) Output files for histogram plotting, and vmd visualisation in output_files/:

4.1) lipids_aligned_x_x_x.gro	Aligned trajectory. One should convert to xtc:

	 trjconv -f lipids_aligned_x_x_x.gro -s simulation_tprfile.tpr.tpr -o lipids_x_x_x.xtc -pbc mol -n index.ndx -center

4.2) x_CLpositions.mat		Contains vectors with x positions of CL in each leaflet, so one can plot hisograms. Also contains buckle shape.


4.3) lipids_eds_x_x_x.psf  	Output from build_bond_matrix.m. This is a psf file used for bond visualisation in vmd

